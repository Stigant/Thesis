%\documentclass[12pt,twoside]{amsart}
%\usepackage{mabliautoref}
%\usepackage{amssymb,amsthm,amsmath}
%\RequirePackage[dvipsnames,usenames]{xcolor}
%\usepackage{hyperref}
%\usepackage{mathtools}
%%\usepackage{showkeys}
%\usepackage[abbrev,alphabetic]{amsrefs}
%\usepackage[all]{xy}
%\usepackage{tikz}
%\usepackage{tikz-cd}
%\usepackage{systeme}
%
%\hypersetup{
%	bookmarks,
%	bookmarksdepth=3,
%	bookmarksopen,
%	bookmarksnumbered,
%	pdfstartview=FitH,
%	colorlinks,backref,hyperindex,
%	linkcolor=Sepia,
%	anchorcolor=BurntOrange,
%	citecolor=MidnightBlue,
%	citecolor=OliveGreen,
%	filecolor=BlueViolet,
%	menucolor=Yellow,
%	urlcolor=OliveGreen
%}
%
%%%%%
%%%%%%%%
%
%
%
%%\usepackage{etoolbox}
%%\AtBeginEnvironment{theorem}
%%{\setlength{\parskip}{0.5em}}
%%\AtBeginEnvironment{itemize}
%%{\setlength{\parskip}{0em}}
%%\AtBeginEnvironment{enumerate}
%%{\setlength{\parskip}{0em}}
%%\AtBeginEnvironment{reptheorem}
%%{\setlength{\parskip}{0.5em}}
%
%\makeatletter
%\newcommand{\newreptheorem}[2]{\newtheorem*{rep@#1}{\rep@title}\newenvironment{rep#1}[1]{\def\rep@title{#2 \ref*{##1}}\begin{rep@#1}}{\end{rep@#1}}}
%\makeatother
%\makeatletter
%\@namedef{subjclassname@2020}{%
%	\textup{2020} Mathematics Subject Classification}
%\makeatother
%
%
%%\newreptheorem{theorem}{Theorem}
%
%%begin: Iacopo-defined newcommands
%\DeclareMathOperator{\Spec}{Spec}
%\DeclareMathOperator{\Proj}{Proj}
%\newcommand{\bP}{\mathbb{P}}
%\newcommand{\bR}{\mathbb{R}}
%\newcommand{\bQ}{\mathbb{Q}}
%\newcommand{\bN}{\mathbb{N}}
%\newcommand{\bZ}{\mathbb{Z}}
%\newcommand{\fB}{\mathbf{B}}
%\newcommand{\fM}{\mathbf{M}}
%\newcommand{\charac}{\textup{char }}
%\newcommand{\id}{\textup{id}}
%\newcommand{\Alb}{\textup{Alb}}
%\newcommand{\cO}{\mathcal{O}}
%\newcommand{\red}{\textup{red}}
%\newcommand{\lct}{\textup{lct}}
%\newcommand{\exc}{\textup{Ex}}
%\newcommand{\coeff}{\textup{coeff}}
%\newcommand{\cent}{\textup{centre}}
%\newcommand{\codim}{\textup{codim}}
%\newcommand{\textoverline}[1]{$\overline{\mbox{#1}}$}
%\newcommand{\rk}{\textup{rk}}
%\newcommand{\WDiv}{\textup{WDiv}}
%%end: Iacopo-defined newcommands
%
%
%\newcommand{\A}{\mathcal{A}}
%\newcommand{\B}{\mathcal{B}}
%\newcommand{\C}{\mathcal{C}}
%\newcommand{\D}{\Delta}
%\newcommand{\E}{\mathcal{E}}
%\newcommand{\F}{\mathcal{F}}
%\newcommand{\PP}{\mathcal{P}}
%\newcommand{\HH}{\mathcal{H}}
%\newcommand{\SB}{\mathbf{SB}}
%\newcommand{\BS}{\mathbf{B}_{+}}
%\newcommand{\disc}{\textup{Discrepancy}}
%
%
%
%\newcommand{\ta}[1]{\mathcal{A}^{\leq #1}}
%\newcommand{\at}[1]{\mathcal{A}^{\geq #1}}
%\newcommand{\tb}[1]{\mathcal{B}^{\leq #1}}
%\newcommand{\bt}[1]{\mathcal{B}^{\geq #1}}
%\newcommand{\tc}[1]{\mathcal{C}^{\leq #1}}
%\newcommand{\ct}[1]{\mathcal{C}^{\geq #1}}
%\newcommand{\nklt}{\textup{Nklt}}
%\newcommand{\Ht}[1]{H^{i}_{t}}
%\newcommand{\orth}{^{\perp}}
%\newcommand{\Hom}{\textup{Hom}}
%\newcommand{\Fe}{F^{e}_{*}}
%\newcommand{\Fn}[1]{F^{#1}_{*}}
%\newcommand{\trip}{(R,\Delta, \alpha_{\bullet})}
%\newcommand{\ai}{\alpha_{\bullet}}
%\newcommand{\im}{\textup{Im}}
%\newcommand{\ox}[1][X]{\mathcal{O}_{#1}}
%\newcommand{\me}{M^{e}_{\Delta,a^{t}}}
%\newcommand{\psim}{\sim_{\mathbb{Z}_{(p)}}}
%\newcommand{\zp}{\mathbb{Z}_{(p)}}
%\newcommand{\Xde}[1]{\mathcal{X}_{\delta,\epsilon,#1}}
%\newcommand{\Pde}[1]{\mathcal{P}_{\delta,\epsilon,#1}}
%
%\newtheorem{case}{Case}
%
%\usepackage{xcolor}
%\newcommand\myworries[1]{\textcolor{red}{#1}}
%
%\newcommand{\coker}{\textup{coker }}
%
%\title[Abundance for arithmetic threefolds]{Abundance theorem for threefolds in mixed characteristic}
%
%\author{Fabio Bernasconi, Iacopo Brivio, and Liam Stigant}
%
%\address{\'Ecole Polytechnique F\'ed\'erale de Lausanne, Chair of Algebraic Geometry
%	(B\^atiment MA), Station 8, CH-1015 Lausanne} 
%\email{fabio.bernasconi@epfl.ch}
%
%\address{National Center for Theoretical Sciences, Taipei, 106, Taiwan}
%\email{ibrivio@ncts.ntu.edu.tw}
%
%\address{Department of Mathematics, Imperial College London, 180 Queen's Gate, 
%	London SW7 2AZ, UK} 
%\email{l.stigant18@imperial.ac.uk}
%
%\subjclass[2020]{14J30, 14J32, 14M22 14E30, 14G17, 14B05}
%\keywords{Abundance conjecture, mixed characteristic, invariance of plurigenera}
%%\date{\today}
%
%%\pagestyle{myheadings} \markboth{\hfill  Liam Stigant
%%	\hfill}{\hfill Abundance in mixed characteristic\hfill}
%
%\begin{document}

	\chapter{Abundance}\label{abundance-sect}
	%\section{Introduction}
	
	The key focus of this section is to show the validity of the abundance conjecture for mixed characteristic threefolds. It contains the main results of \cite{bernasconi2021abundance} and the work was completed in collaboration with F. Bernasconi and I. Brivio. 
	
	We work under the assumption that the residue fields of closed points of $R$ have characteristic $p>5$. This can be loosened somewhat. So long as $X_{\mathbb{Q}}$ has dimension at most $2$ the abundance result holds. This can be checked by localising at closed point of positive characteristic and applying \autoref{abundance-dim2} on $X_{\mathbb{Q}}$, since semiampleness is local on the base.
	
	\begin{theorem}\label{Main_Abund1}\autoref{abundance}
		Let $R$ be an excellent ring of finite Krull dimension, equipped with a dualising complex and whose residue fields of closed points have characteristic $p>5$.
		
		Suppose that $(X,B)/T$ is an $R$-pair of dimension $3$ with positive dimensional image.
		Suppose $(X,B)$ is a three-dimensional klt pair with $\mathbb{R}$-boundary. If $K_X+B$ is nef, then it is semiample.
	\end{theorem}

	

	A well-known and immediate consequence of abundance is the finite generation of the canonical ring.
	
	\begin{theorem}
		Let $R$ be an excellent ring of finite Krull dimension, equipped with a dualising complex and whose residue fields of closed points have characteristic $p>5$.
		
		Suppose that $(X,B)/T$ is an $R$-pair of dimension $3$ with positive dimensional image with $\mathbb{Q}$-boundary. 
		
		Then the canonical $\ox[T]$-algebra
		\[R(\pi,\Delta):=\bigoplus_{m \in \mathbb{N}} \pi_{*}\ox(\lfloor m(K_{X}+\Delta)\rfloor)\]
		is finitely generated.
	\end{theorem}

	In characteristic $0$, finite generation of the canonical ring follows from finite generation in the log general type case (\cite{BCHM10}) and by a result of Fujino and Mori \cite[Theorem 5.2]{FM00}. However, their result requires a canonical bundle formula which is not available in the positive or mixed characteristic settings.


	\begin{theorem}\label{Main_Abund2}\autoref{thm:ADIOP_final2}
		Let $R$ be an excellent DVR such that the residue field $k$ has characteristic $p>5$.
		Let $(X,B)$ be a three-dimensional klt $R$-pair and let $(X,B)\to \Spec(R)$ be a projective, surjective morphism.  Suppose that the following conditions are satisfied:
		
		\begin{enumerate}
		\item[(1)] $(X,X_{k}+B)$ is plt with $X_k$ integral and normal;
		\item[(2)] ${\mathbf{B}_{-}(X, K_{X}+B)}$ contains a non-canonical centre $V$ of $(X,B+X_{k})$ only if $\dim V_{k}=\dim V -1$.
		\end{enumerate}
		
		Suppose further that at least one of the following holds:
		\begin{enumerate}
			\item $\kappa(K_{X_{k}}+B_{k}) \neq 1$; or
			\item $B_{k}$ is big over $\textup{Proj}(K_{X_{k}}+B_{k})$
		\end{enumerate}	
		Then there is $m_{0} \in \mathbb{N}$ such that 
		$$h^{0}(X_{K},m(K_{X_{K}}+B_{K}))=h^{0}(X_{k},m(K_{X_{k}}+B_{k}))$$
		for all $m \in m_{0}\mathbb{N}$.
		
	\end{theorem}

	\section{Preliminaries}
	


%	\begin{enumerate}
%		\item In this article, $R$ denotes an excellent ring of finite Krull dimension, equipped with a dualising complex and whose residue fields of closed points have characteristic $p>5$.
%		\item We say $(X, \Delta)$ is a \emph{log pair} if $X$ is an excellent normal scheme with a dualising complex, $\Delta$ is a $\mathbb{K}$-divisor and $K_X+\Delta$ is $\mathbb{K}$-Cartier, where $\mathbb{K}=\mathbb{Q}$ or $\mathbb{R}$.  When not specified we default to $\mathbb{K}=\mathbb{R}$. By $\dim(X)$ we mean the dimension of the scheme $X$.
%		%	\item For us, an $R$-pair $(X,\Delta)/T$ with $\mathbb{K}$-boundary is a projective, surjective morphism $X \to T$ of normal integral schemes of finite type over $R$, with $T$ quasi-projective over $R$, such that $K_X+\Delta$ is $\mathbb{K}$-Cartier and $X_{\mathbb{Q}} \neq \emptyset$. When $T=\Spec (R)$ it is omitted from the notation. Here $\mathbb{K}=  \mathbb{Q}$ or $\mathbb{R}$ and. When we say $\dim(X)$ we mean the dimension of the scheme $X$.
%		\item For the definitions of the singularities of the MMP (as klt, plt, lc), we refer to \cite{kk-singbook,bhatt2020}.
%		\item A \textit{contraction} of normal schemes is a projective morphism $f\colon X\to Y$ such that $f_*\cO_X=\cO_Y$.  A \emph{birational contraction} $\varphi \colon X \dashrightarrow Y$ is a birational map of normal integral schemes such that $\varphi^{-1}$ does not contract any divisor.
%		\item Let $L$ be a nef line bundle on a scheme $X$ projective over $S$. We define $\mathbb{E}(L)$ to be the union of subschemes of $X$ on which the restriction of $L$ is not big.
%		\item If $X \to S$ is a projective morphism and $D$ is a $\mathbb{Q}$-Cartier divisor on $X$, the \emph{diminished locus of $D$ over $S$}  is  $$\mathbf{B}_{-}(D/S) = \bigcup_{A \, \mathbb{Q}\text{-divisor} \text{ ample }/S} \mathbf{B}(D+A/S),$$ where $\mathbf{B}(D+A/S)$ is the stable base locus of $D+A$ over $S$. If $S$ is clear from the context, we will simply write $\mathbf{B}_{-}(D)$.
%		\item We say that a field $k$ of positive characteristic $p>0$ is $F$-finite if $[k:k^p]< \infty$.
%		\item When $R$ is a DVR with residue field $k$ and fraction field $K$, and $(X,\Delta)$ is a pair defined over $R$, we will denote the special, resp. generic, fibre as $X_{k}$, resp. $X_K$. An analogous notation will be used for sheaves and $R$-horizontal $\mathbb{K}$-divisors on $X$.
%	\end{enumerate}

	\subsection{Algebraic spaces}
	
	We refer to \stacks{0ELT} for the definition of algebraic spaces and their general theory. We record here a few key results to be used later. First, Stein factorisation exists for algebraic spaces. 
	
	\begin{theorem}[Stein factorisation, \stacks{0A1B}]\label{Stein}
		Let $S$ be a scheme and $f \colon X \to Y$ be a proper morphism of Noetherian algebraic spaces over $S$. 
		Then there is a morphism $f' \colon X \to Y'$, together with a finite morphism $\pi \colon Y' \to Y$, factorising $f$ into $f=\pi \circ f'$  such that
		\begin{itemize}
			\item $f'$ is proper and surjective;
			\item $f'_{*}\ox = \ox[Y']$;
			\item $Y'=\underline{\textup{Spec}}_{Y}(f_{*}\ox)$;
			\item and $Y'$ is the normalisation of $Y$ in $X$.
		\end{itemize}
		We call $f=\pi\circ f'$ the Stein factorisation of $f$.
	\end{theorem}
	
	In particular if $X$ is normal in \autoref{Stein}, then so is $Y'$. Moreover if $X,Y$ are schemes then this agrees with the usual notion of Stein factorisation.
	We also have the following descent result for proper contractions of algebraic spaces.
	
	\begin{lemma}\label{as-ext}
		Let $f \colon W \to X$ and $g \colon W \to Y$ be contraction of Noetherian integral normal algebraic spaces over $S$. 
		Suppose that every proper curve $C \subset W$ contracted by $f$ is contracted by $g$. 
		Then there is a contraction $h\colon X \to Y$ with $g=h \circ f$. Morover, $h$ is unique.
	\end{lemma}
	
	\begin{proof}
		First, note that any $h\colon X\to Y$ such that $g=h \circ f$ is necessarily a contraction.
		Consider $(g\times_S f)\colon W \to X \times_S Y$ and let $\phi \colon W \to \Gamma$ be the contraction part of its Stein factorisation.
		Thus $\Gamma$ is an integral, normal algebraic space which is proper over $S$. If $\gamma\colon \Gamma\to X$ is the induced morphism, it is then enough to show that $\gamma$ is an isomorphism.
		
		Let $x\in X$ be any point, and let $F:=\gamma^{-1}(x)$. Then $\phi^{-1}(F)=f^{-1}(x)$ is contracted by $g$, hence by $\phi$, so $\gamma$ is quasi-finite.
		
		Let $\xi\in X$ be the generic point. As $f$ is a contraction, we have $H^0(W_\xi,\cO_{W_\xi})=\kappa(\xi)$. As $\phi$ is a contraction and Stein factorisation commutes with flat base-change, we have that $\phi_\xi\colon W_\xi\to\Gamma_\xi$ is a contraction as well, thus $H^0(\Gamma_\xi,\cO_{\Gamma_\xi})=H^0(\Gamma_\xi,\phi_{\xi,*}\cO_{W_\xi})=\kappa(\xi)$. By \cite[\href{https://stacks.math.columbia.edu/tag/0AYI}{Tag 0AYI}]{stacks-project} we then have that $\gamma$ is a contraction, and by \cite[\href{https://stacks.math.columbia.edu/tag/082I}{Tag 082I}]{stacks-project} we conclude it is an isomorphism.
	\end{proof}
	
	\begin{remark}
		The notion of an integral algebraic space, \cite[Tag 0AD3]{stacks-project}, is somewhat subtle. However we will only ever apply \autoref{as-ext} in the case where $W,X$ are integral schemes, in which case $W,X,Y$ are also integral as algebraic spaces.
	\end{remark}
	
	It will prove useful to know that proper algebraic spaces are schemes on a big open set.
	
	\begin{lemma}\label{l-cod1}
		Let $S$ be a Noetherian scheme and $X$ be a proper algebraic space over $S$. 
		Then there is an open immersion of a scheme $U\to X$ whose image is a big open subset of $X$. 
		If $X$ is normal, we can choose $U$ to be regular.
	\end{lemma}
	
	\begin{proof}
		By \stacks{0ADD}, for each codimension $1$ point $P \in X$ there is an open subspace $U_{P}$ containing $P$ which is a scheme.
		Take the open subspace   $U=\bigcup_{\codim_X(P)=1} U_{P},$
		of $X$.
		By \cite[\href{https://stacks.math.columbia.edu/tag/01JJ}{Tag 01JJ}]{stacks-project} we observe that in fact $U$ is a scheme. Note that $U$ is a sheaf on the Zariski topology since by definition it is a sheaf on the finer fppf topology, \stacks{025Y}. 
		
		If $X$ is normal, then so too are the $U_{P}$, in particular after shrinking them as needed we may suppose that each $U_{P}$ is regular and thus that $U$ is regular.
	\end{proof}
	
	\subsection{Semiample and EWM line bundles}
	
	In this subsection we recall some basic results about semiample and EWM line bundles we will need later on. We fix $S$ to be a excellent Noetherian base scheme.
	
	\begin{definition}
		Let $\varphi \colon X \to S$ be a proper morphism. A line bundle $L$ on $X$ is said to be \textit{semiample} over $S$ if there exists $m>0$ such that $L^{\otimes m}$ is globally generated over $S$, \emph{i.e.} the natural morphism $\varphi^*(\varphi_*L^{\otimes m}) \to L^{\otimes m}$ is surjective.
	\end{definition} 
	
	\begin{theorem}\label{t-semiamplefibration}
		Let $X$ be a normal projective $S$-scheme and let $L$ be a line bundle on $X$. Then the following are equivalent.
		\begin{enumerate}
			\item $L$ is semiample over $S$;
			\item there is a contraction 
			$f\colon X\to Z/S$
			such that $f$ is the $S$-morphism induced by $|L^m/S|$ for all sufficiently divisible $m$;
			\item There is a contraction 
			$f\colon X\to Z/S$
			such that $L\sim_{\mathbb{Q}} f^{*}A$ for $A$ ample $\mathbb{Q}$-Cartier $\mathbb{Q}$-divisor on $Z$.
		\end{enumerate}
	\end{theorem}
	
	\begin{proof}
		The direction $(1) \implies (2) \implies (3)$ is the content of \cite[Theorem 2.1.26]{La1}. That $(3) \implies (1)$ follows straight from the definition of ample.
	\end{proof}
	
	The morphism $f$ is the same in both (a) and (b) of \autoref{t-semi-amplefibration} is called the \textit{semi-ample fibration of $L$}.	
	
	\begin{definition}
	Let $\varphi \colon X \to S$ be a proper morphism of schemes. 
	A nef line bundle $L$ on $X$ is said to be \emph{EWM over $S$} if there exists a proper $S$-morphism $f \colon X \rightarrow Y$ to an algebraic space $Y$ proper over $S$ such that an integral closed subscheme $V \subset X$ is contracted (that is, $\dim(V) < \dim (f(V))$) if and only if $L|_V$ is not big. 
	\end{definition}
	
	By \autoref{Stein}, we can suppose $f$ is a contraction and we call this the \emph{EWM-contraction} associated to $L$, which is unique up to isomorphism by \autoref{as-ext}.
	
	The definition of semiample (resp. EWM) extends naturally to $\mathbb{Q}$-Cartier divisors (resp. $\mathbb{R}$-Cartier divisors).
	We say that an $\mathbb{R}$-Cartier divisor $D$ is semiample if there exist $r_i>0$ and $L_i$ semiample Cartier divisors such that $D \sim_{\mathbb{R}}\sum_i r_{i}L_{i}$. A natural extension of condition $(c)$ in \autoref{t-semiamplefibration} is that $D$ is semiample if and only if there is a morphism $f \colon X \to Z$ of $S$-schemes such that $D\sim_{\mathbb{R}} f^*A,$ where $A$ is an ample $\mathbb{R}$-divisor over $S$. Note that any semiample $\mathbb{R}$-Cartier divisor is EWM.
	

	\subsubsection{Semiampleness Criteria}
	
	We recall the Keel-Witaszek Theorem, which will be a crucial tool in the proof of abundance.

	
	\begin{theorem}\cite[Theorem 6.1]{witaszek2020keels}, \cite[Theorem 2.44]{bhatt2020}
		Let $L$ be a nef line bundle on a scheme $X$
		projective over an excellent Noetherian base scheme $S$. Then $L$ is semiample (resp. EWM) over $S$ if and only if both $L|_{\mathbb{E}(L)}$ and $L|_{X_{\mathbb{Q}}}$
		are so. 
	\end{theorem}
	
	We will need the following descent result on semiampleness for normal schemes.
	
	\begin{lemma}\label{pullback}
		
		Let $f \colon X \to Y$ be a proper surjective morphism of integral, excellent schemes over a base $S$. Suppose that $Y$ is normal and $L$  is a line bundle on $Y$ such that $f^{*}L$ semiample over $S$.
		Then $L$ is semiample over $S$.
		
	\end{lemma}
	
	\begin{proof}
	The proof is similar to \cite[Lemma 2.10]{Keel}.	
	We may freely assume that $X$ is normal. 
	Let $X \xrightarrow{\varphi} Z \xrightarrow{\psi} Y$ be the Stein factorisation of $f$, where $\varphi$ is a contraction and $\psi$ is a finite map. 
	We first show that $\psi^*L$ is semi-ample. Take $m>0$ such that $f^*L^{ m}$ is base point free. By the projection formula $H^0(X, f^*L^{m})=H^0(Z, \psi^*L^{m})$ and so $\psi^*L^{m}$ is base point free.
	
	We can thus assume that $f$ is a finite morphism of degree $d$.
	By \stacks{0BD3}, there exists a norm function $\Norm_f \colon f_*\mathcal{O}_X \to \mathcal{O}_Y$ of degree $d$ for $f$ which induces a group homomorphim $\Norm_f \colon \text{Pic}(X) \to \text{Pic}(Y)$ by \stacks{0BCY}. Take $m>0$ such that $f^*L^{m}$ induces the semi-ample fibration, and let $y\in Y$ be a point. Then there is a section $s\colon \cO_X\to f^*L^{m}$ not vanishing at any of the points in $f^{-1}(y)$. By \stacks{0BCY} and \stacks{0BCZ} we then construct a section $\Norm_f(s)\colon \cO_{Y}\to L^{md}$ not vanishing at $y$, concluding.
	
\end{proof}

	We will need a similar, but slightly weaker result for algebraic spaces. First we make the following observation.

	\begin{lemma}\label{com-big}
	Let $S$ be an excellent Noetherian scheme and $f \colon Y \to X$ be a contraction of integral normal schemes, proper over S. Let $L$ be an $S$-nef line bundle on $X$. Choose $V,V'$ integral closed subschemes of $X$ and $Y$ respectively with $f(V')=V$. Then $f^{*}L$ is $S$-big on $V'$ if and only if $L$ is $S$-big on $V$ and $\dim (V)=\dim (V')$.  
	\end{lemma}

	\begin{proof}
	
	Let $d$ be the dimension of $V'$. Since $f^{*}L$ is nef, it is big on $V'$ if and only if $(f^{*}L)^{d} \cdot V'>0$.
	Hence by the projection formula (\cite[Proposition VI.2.11]{k-rat-curves}) it is big on $V'$ if and only if $L^{d} \cdot V> 0$. In turn this occurs if and only if $\dim (V) =d$ and $L$ is big on $V$.
\end{proof}

\begin{lemma}\label{pp-EWM}
	Let $S$ be an excellent Noetherian scheme and suppose $f \colon Y\to X$ is a contraction of integral normal projective $S$-schemes.
	A line bundle $L$ on $X$ is EWM if and only if $f^{*}L$ is so.	
\end{lemma}

\begin{proof}
	Suppose first that $L$ is EWM and let $g \colon X \to Z$ be the associated EWM-contraction. 	
	We claim that $h=g \circ f$ contracts an integral subscheme $V$ of $Y$ if and only if $f^{*}L|_{V}$ is not big. 	
	By \autoref{com-big}, $f^{*}L|_{V}$ is not big if and only $\dim (f(V))< \dim (V)$ or $L|_{f(V)}$ is not big, concluding. %Therefore $V$ is contracted by $h$ if and only $f^{*}L|_{V}$ is not big.
	
	Now suppose that $f^{*}L$ is EWM. Let $g \colon Y \to Z$ be the associated EWM-contraction. 
	By \autoref{as-ext} there exists a morphism $h \colon X \to Z$ with $g=h\circ f$. 
	Take $V\subset X$ integral of dimension $d$. We can choose an integral $V'$ lying over $V$ of dimension $d$ by cutting $f^{-1}(V)$ with hyperplanes and taking a dominant component. 
	By \autoref{com-big} we see that $L$ is not big on $V$ if and only if $V'$ is contracted by $h$, concluding.
\end{proof}

\begin{remark}
	Clearly, if $L$ is an EWM line bundle on $X$ and $T$ is any integral closed subscheme, then $L|_{T}$ is EWM.    
\end{remark}

	\subsubsection{Semiample line bundles over DVRs}
	We now specialize to the case in which $X\to\Spec (R)$ is a family of normal projective varieties over a DVR and we study how the spaces of global sections of $L$ behave in family. 	Given a $\mathbb{Q}$-Cartier $\bQ$-divisor $L$ on a normal variety $X$ over a field $k$, we denote by $\kappa(L)$ its Iitaka dimension (see \cite[Definition 2.1.3]{Laz04}).
	
	\begin{lemma}\label{lemma_DIOK}
		Let $R$ be a DVR and let $\pi \colon X\to \Spec (R)$ be a flat projective morphism. 
		Let $L$ be a $\bQ$-Cartier divisor on $X$, semiample over $R$. 
		Then $\kappa(L_k)=\kappa(L_K)$.
	\end{lemma}
	
	\begin{proof}
	Let $f\colon X \to Z$ be the semi-ample fibration of $L$ over $R$, let $\delta\colon Z\to\Spec(R)$ be the structure morphism, and note that $\delta$ is flat, hence equi-dimensional. Let $d$ be the dimension of the fibers of $\delta$, and let $A$ be an ample $\bQ$-divisor on $Z$ such that $L\sim_{\bQ}f^\ast A$. By the projection formula (\cite[\href{https://stacks.math.columbia.edu/tag/01E8}{Tag 01E8}]{stacks-project})  and asymptotic Riemann-Roch (\cite[Theorem VI.2.15]{k-rat-curves}), for each $t \in \Spec(R)$ we have
	\begin{equation*}
	\begin{split}
	h^0(X_t,mL_t)&=h^0(Z_t,f_{t,*} \cO_{X_t}\otimes\cO_{Z_t}(mA_t))\\
	&=\mathrm{rk} (f_{t,*} \cO_{X_t})\frac{(mA_t)^d}{d!}+O(m^{d-1})
	\end{split}
	\end{equation*}
	for all $m> 0$ sufficiently divisible. Thus we conclude $\kappa(L_t)=d$ for each $t \in \Spec(R)$.
	\end{proof}
	
	
	\begin{lemma}\label{l-stein-invariance}
	Let $R$ be a DVR and let $\pi \colon X \to \Spec(R)$ be a flat, projective, normal, integral $R$-scheme such that $X_k$ is normal. 
	Let $L$ be a $\bQ$-Cartier $\bQ$-divisor on $X$, semi-ample over $R$ and let $f \colon X \to Z$ be the semi-ample fibration induced by $L$.
	Then the following are equivalent:
	\begin{enumerate}
		\item[(1)] $f_{k,*} \cO_{X_k} = \cO_{Z_k}$;
		\item[(2)] $h^0(X_k, mL_k)=h^0(X_K, mL_K)$ for all $m\geq 0$ sufficiently divisible.
	\end{enumerate}
\end{lemma}

\begin{proof}
	Let $A$ be an ample $\bQ$-divisor on $Z$ such that $L \sim_{\bQ}f^*A$. 
	By the projection formula we have 
	\begin{equation}\label{e-globalsectionsPF}
	h^0(X_t,mL_t)=h^0(Z_t,f_{t,\ast}\cO_{X_t}\otimes\cO_{Z_t}(mA_t))
	\end{equation}
	for all sufficiently divisible $m$ and all $t\in \Spec (R)$. By flat base change we have $f_{K,\ast}\cO_{X_K}=\cO_{Z_K}$.
	
	$(1) \Rightarrow (2)$. Suppose that $f_{k,\ast}\cO_{X_k}=\cO_{Z_k}$. Then the right hand side of Equation (\ref{e-globalsectionsPF}) coincides with $\chi(Z_t,mA_t)$ when $m\gg 0$ by Serre vanishing. Hence we conclude by invariance of the Euler characteristic in a flat family.
	
	$(2) \Rightarrow (1)$. By Grauert's theorem (\cite[Corollary III.12.9]{Ha77}) the natural restriction map
	$H^0(X,\mathcal{O}_X(mL))\to H^0(X_k,\mathcal{O}_{X_k}(mL_k))$
	is surjective for all $m \geq 0$ sufficiently divisible. Hence $f_k$ is the semi-ample fibration of $L_k$ by \autoref{t-semi-amplefibration}, in particular $f_{k,\ast}\cO_{X_k}=\cO_{Z_k}$. 
\end{proof}
	
	\begin{remark}\label{r-connected fibers v contraction}
	Suppose that $Z_{k}$ is normal in \autoref{l-stein-invariance} and let $X_{k}\to Y_{k} \xrightarrow{g} Z_{k}$ be the Stein factorisation of $f_{k}$. If $k$ is a field of characteristic $0$ then $g$ is birational and finite, hence an isomorphism.
	
	On the other hand if $k$ is a positive characteristic field then $g$ may be a non-trivial purely inseparable morphism of normal varieties. This an obstruction to lifting sections of $mL_k$ (see \cite{Bri20} for an explicit construction with $L=K_X+B$). For this reason, a crucial step in \autoref{thm:ADIOP_SA} will be showing $f_{k,*} \mathcal{O}_{X_k}=\mathcal{O}_{Z_k}$ for the semi-ample fibration of the canonical divisor.
	\end{remark}
	
		
	\subsection{MMP in families}

	We fix $R$ to be an excellent DVR with residue field $k$ of characteristic $p>5$.
	We collect some results on the MMP in families over $R$ that we will use in \autoref{s-inv-plurigenera}. In particular we study the behaviour of the diminished base locus $\mathbf{B}_{-}(K_X+\Delta)$ under the steps of the MMP.
	
	\begin{definition}
	If $X \to S$ is a projective morphism and $D$ is a $\mathbb{Q}$-Cartier divisor on $X$, the \emph{diminished locus of $D$ over $S$}  is  $$\mathbf{B}_{-}(D/S) = \bigcup_{A \, \mathbb{Q}\text{-divisor} \text{ ample }/S} \mathbf{B}(D+A/S).$$
	If $S$ is clear from the context, we will simply write $\mathbf{B}_{-}(D)$.
	\end{definition}

	\begin{lemma}\label{l-stable-base-loci}
	Let $(X,\Delta)$ be a klt pair, projective over a quasi-projective $R$-scheme $T$.
	Let $f\colon X \dashrightarrow Y$ be a step of a  $(K_X+\Delta)$-MMP over $T$ and write $\Delta_Y=f_*\Delta$.
	Let
	\begin{equation*}
	\xymatrix{
		& W \ar[dr]^q \ar[dl]_p & \\
		X \ar@{-->}[rr]^{f} & & Y}
	\end{equation*} 
	be a resolution of indeterminacies of $f$.
	Then $q^{-1}\mathbf{B}_{-}(K_Y+\Delta_Y) \subset p^{-1}\mathbf{B}_{-}(K_X+\Delta).$
\end{lemma}

\begin{proof}
	By the negativity lemma, we deduce $p^*(K_X+\Delta)=q^*(K_Y+\Delta_Y)+G,$ where $G \geq 0$ and therefore we clearly have the following containment of stable base loci: $q^{-1}\mathbf{SB}(K_Y+\Delta_Y) \subset p^{-1}\mathbf{SB}(K_X+\Delta).$
	Similarly, note that for every sufficiently small ample $A$ on $X$,
	a $(K_X+\Delta)$-MMP step is a $(K_X+\Delta+A)$-MMP step. As $A$ is ample and $f$ birational, we can write $f_*A \sim_{\mathbb{Q}} H+E$, where $H$ is ample and $E$ effective. 
	Therefore  $q^{-1}\mathbf{SB}(K_Y+\Delta_Y+\frac{1}{n}H) \subset q^{-1}\mathbf{SB}(K_Y+\Delta_Y+ \frac{1}{n}f_*A)\subset  p^{-1}\mathbf{SB}(K_X+\Delta+ \frac{1}{n}A) $.
	As $\mathbf{B}_{-}(K_Y+\Delta_Y)=\bigcup_{n \geq 0} \mathbf{SB}(K_Y+\Delta_Y+\frac{1}{n}H)$ by \cite[Proposition 1.19]{asympt-baseloci} we conclude.
\end{proof}

We recall that, given a log pair $(X,\Delta)$, a \emph{non-canonical centre} $V$ of $(X,\Delta)$ is the centre of a divisorial valuation $E$ with discrepancy $a(E, X, \Delta)<0$.  The following is a generalisation of \cite[Lemma 3.1]{HMX18} for general threefolds over DVRs. 

\begin{proposition}\label{lemma:MMP_in_fam2}
	Let $R$ be an excellent DVR with residue field $k$ of characteristic $>5$. Let $X \to \Spec(R)$ be a projective contraction and suppose that $(X,B)$ is a $\bQ$-factorial klt threefold pair with $\mathbb{Q}$-boundary.
	Suppose the following conditions are satisfied:
	\begin{itemize}
		\item[(1)] $(X,B+X_k)$ is plt with $X_k$ integral;
		\item[(2)] if $V$ is a non-canonical centre of $(X,B+X_k)$ contained in ${\mathbf{B}_{-}(K_{X}+B)}$, then $\dim (V_{k})=\dim (V) -1$.
	\end{itemize}
	Let $f \colon X\dashrightarrow Y$ be a step of a $(K_X+B)$-MMP over $R$. Then:
	\begin{enumerate}
		\item  If $f$ is a contraction of fibre type, then so is $f_k$;
		\item if $f$ is birational, then:
		\subitem(i) $f$ is a divisorial contraction;
		\subitem(ii) if $\Gamma:=f_\ast B$, then conditions (1) and (2) also hold for $(Y,\Gamma)$.
	\end{enumerate} 
	In particular, if $f$ is projective birational then $h^0(X_t,m(K_{X_t}+B_t))=h^0(Y_t,m(K_{Y_t}+\Gamma_t))$ for all $t\in\Spec (R)$ and all $m\geq 0$ sufficiently divisible.
\end{proposition}

\begin{proof}
	If $f$ is a contraction of fibre type, hence $f_k$ is not birational by upper semi-continuity of the dimension of the fibres for proper morphisms (\cite[\href{https://stacks.math.columbia.edu/tag/0D4Q}{Tag 0D4Q}]{stacks-project}). 
	
	From now on, we assume that $f$ is birational. Suppose by contradiction that $f$ is a flip and consider the following diagram:
	
	\begin{equation*}
	\xymatrix{
		X \ar@{->}_{g}[rd] \ar@{-->}^{f}[rr]
		&
		& Y \ar@{->}^{g^+}[ld]\\
		&Z,}
	\end{equation*} 
	where $g$ is a $(K_X+B)$-flipping contraction.
	Note that $Y_k$ is irreducible since $f$ does not extract divisors, thus $f_k$ is birational. As $(X,B+X_k)$ is plt, so is $(Y,\Gamma+Y_k)$ hence both $X_k$ and $Y_k$ are normal by \autoref{invAdj3}. 
	
	We now derive the contradiction. Since $f$ is a flip, there exists a prime divisor $D$ on $Y_k$ such that its centre $p$ on $X_k$ is a closed point.
	Since $f_k$ is not an isomorphism at $N$ we have
	$$a(D;X_k,B_k)<a(D;Y_k,\Gamma_k)\leq 0$$
	by \autoref{l:increase-discr}.
	Hence $p$ is a non-canonical centre of $(X_{k},B_k)$. Note that $p \subseteq \textup{Exc}(g) \subseteq \mathbf{B}_{-}(K_{X}+B)$ since $D$ is exceptional over $Z_k$. 
	Moreover $p$ is also a non-canonical centre of $(X,B+X_{k})$ as $$0 > \textup{totdiscrep}(p, X_k, B_k) \geq \textup{discrep}(p, X, X_k+B), $$ by easy adjunction (\cite[Theorem 17.2]{FA}).
	So $p$ is an isolated non-canonical centre of $(X,X_k+B)$ contained in $\mathbf{B}_{-}(K_{X}+B)$, thus contradicting (2).
	
	Thus $f$, and therefore $f_k$, is a divisorial birational projective contraction. Condition (1) holds on $(Y,\Gamma+Y_k)$ immediately, so it remains to check condition (2).
	
	Suppose that $V$ is a non-canonical centre of $(Y,\Gamma+Y_{k})$ and take a model $Z$ dominating $X$ and $Y$, and containing an exceptional divisor $E$ such that $V=\cent_Y(E)$ and $a(E, Y, \Gamma+Y_{k}) <0$. Then by \autoref{l:increase-discr} it must be that $a(E,X,X_k+B) \leq a(E,Y,Y_{k}+\Gamma) < 0$, hence the image, $W$, of $E$ on $X$ is a non-canonical centre of $(X,B+X_{k})$. By \autoref{l-stable-base-loci} if $V \subseteq \mathbf{B}_{-}(K_{Y}+\Gamma)$ then we have $W \subseteq \mathbf{B}_{-}(K_{X}+B)$ as well. In which case $W$ is horizontal and hence so is $V$, therefore (2) holds as claimed.
	
	Since a $(K_X+B)$-MMP over $R$ is a $(K_X+X_k+B)$-MMP, we have that the map $(X_k,B_k) \rightarrow (Y_k, \Gamma_k)$ is a $(K_{X_k}+B_k)$-negative birational contraction and thus $h^0(X_t,m(K_{X_t}+B_t))=h^0(Y_t,m(K_{Y_t}+\Gamma_t))$ for all $t\in\Spec (R)$ and all $m\geq 0$ sufficiently divisible by \autoref{l-stein-invariance}.
\end{proof}

To explain the conditions we need to impose on the non-canonical locus of the family, we revisit an example due to Kawamata (see \cite[Example 4.3]{Kaw99}).
%Note the proof of \autoref{abundance} holds in positive characteristic since $X$ is still of relative dimension $2$ over a DVR. 

\begin{example}	\label{ex-kawamata}
	Let $R$ be an excellent DVR and consider the following diagram of $R$-flat families:
	
	\[\begin{tikzcd}
	\mathcal{X} \ar[rr, dashed, "\phi"] \arrow[rd, "g",swap] \ar[rdd, bend right,
	"f",swap] &   & \mathcal{X}^{+}  \arrow[ld, "g^+"]  \\
	&  \mathcal{Z}    \ar[d]                             & 	\\
	& \Spec(R) &
	\end{tikzcd}
	\] 
	where
	\begin{enumerate}
		\item $\mathcal{X}$ is a terminal threefold and the central fibre $X_0$ is klt with a singular point $p$;
		\item $g$ is an extremal $K_{\mathcal{X}}$-negative flipping contraction;
		\item $\mathcal{X}^{+}$ is regular.
	\end{enumerate}
	%	Note that ${Z_0}$ is klt.
	A local model is given by the Francia flip explained in \cite{Kaw99}. 
	As explained by Kawamata, one can construct such a situation and the map
	$f_*\mathcal{O}_{\mathcal{X}}(mK_{\mathcal{X}}) \to f_* \mathcal{O}_{X_0}(mK_{X_0})$ is not surjective.
	
	%	The map $\mathcal{O}_{\mathcal{X}}(mK_{\mathcal{X}}) \to f_* \mathcal{O}_{X_0}(mK_{X_0})$ is not surjective. This is because the map $$g_*\mathcal{O}_{\mathcal{X}}(mK_{\mathcal{X}})=\mathcal{O}_{\mathcal{Z}}mK_{\mathcal{Z}} \to g_*\mathcal{O}_{X_0}(mK_{X_0})=\mathcal{O}_{Z_0}(mK_{Z_0}) $$	 is not surjective as otherwise $K_{\mathcal{Z}}$ would be $\mathbb{Q}$-Cartier.
	
	Note that this situation is excluded by condition (2) of \autoref{lemma:MMP_in_fam2} and \autoref{thm:ADIOP_final2}.
	Indeed $\textbf{B}_{-}(X_k, K_{X_k})$ clearly contains the flipped locus of $g$, which must contain the non-canonical singular points $p$ of $X_k$. As $\mathcal{X}$ is terminal, $p$ is not the restriction of a horizontal non-canonical centre of $\mathcal{X}$.
\end{example}
	
	
\section{Abundance for mixed characteristic threefolds}

Given a klt pair $(X,\Delta)$ with a projective $R$-morphism $f \colon X \to T$ so that $K_{X}+\Delta$ is $f$-nef, then the abundance conjecture asserts that $K_{X}+\Delta$ is $f$-semi-ample. 
In the case where $(X,\Delta)$ is a klt threefold pair and $K_{X}+\Delta$ (or even just $\Delta$) is big this is immediate by \autoref{t-bpf}. 
We address the remaining cases in this section.

The starting point of our proof is the abundance theorem for surfaces over excellent bases, which we now recall. 

\begin{theorem}\label{abundance-dim2}
	Let $\pi \colon (S,B) \to T$ be a projective and surjective morphism of normal quasi-projective schemes over $R$, 
	where  $(S,B)$ is a klt pair of dimension 2.  
	If $K_{S}+B$ is a $\pi$-nef $\mathbb{Q}$-Cartier $\mathbb{Q}$-divisor, then it is $\pi$-semi-ample.
\end{theorem}

\begin{proof}	
	If $T$ is a field then this is \cite[Theorem 1.2]{fujino2012log} for perfect fields and \cite{tanaka2020abundance} for imperfect fields. 
	Suppose from now on that $\dim (T) > 0$.
	If $K_{S}+B$ is big over $T$ then this follows immediately from the base-point-free theorem (\cite[Theorem 4.2]{Tan18}) with $D=2(K_{S}+B)$. Hence we may suppose that $\dim (T)=1$ and $K_{S}+B$ is not big. In this case we have $(K_{S}+B)|_{S_{K(T)}} \sim_{\mathbb{Q}} 0$ by the abundance theorem for curves (\cite[Lemma 9.22]{bhatt2020}) and the result follows by \autoref{lemma:EDsemi-ampleness}.
\end{proof}

The following is \cite[Lemma 2.17]{cascini2020relative}. We include the proof for completeness as the result is used often.


\begin{lemma}\label{lemma:EDsemi-ampleness}
	Let $f\colon X \to Y$ be a contraction of integral, normal and excellent schemes. Suppose $L$ is an $f$-nef $\mathbb{Q}$-Cartier $\bQ$-divisor with $L|_{X_{K(Y)}} \sim_{\mathbb{Q}} 0$. If $Y$ is $\mathbb{Q}$-factorial and $f$ is equi-dimensional then $L \sim_{Y,\mathbb{Q}} 0$.
\end{lemma}

\begin{proof}
	Since $L|_{X_{K(Y)}} \sim_{\mathbb{Q}} 0$ we may write $L\sim_{Y, \mathbb{Q}} D\geq 0$ such that $D|_{X_{K(Y)}}=0$. If $C$ is any component of $D$ then $f(C)$ is a prime divisor, since $f$ is equi-dimensional. Thus, since $Y$ is $\mathbb{Q}$-factorial, it is enough to know that $L \sim_{\bQ,Y} 0$ after localisation about any codimension one point of $Y$. In particular we may suppose that $Y= \Spec (R)$ for some DVR $R$ with closed point $p$.
	
	Let $\left\{G_i \right\}_{i=1}^n$ be the irreducible components of the special fibre $F_p=f^*p$, so that by construction $D = \sum_{i=1}^n a_i G_i$ for certain $a_i \geq 0$.	
	
	We introduce $r:= \min \left\{ t \mid D -tF_p \leq 0 \right\}$. We are left to show that $D-rF_p=0$. 
	If not, up to rearranging the order of $G_i$, we have $D-rF_p=-\sum_{i=2}^n l_i G_i \equiv_Y 0$, with $l_2 >0, l_i \geq 0$ and $G_{1}$ meeting $G_{2}$. Note that $(rF_p-D)$ is effective curve not containing $G_{1}$ but intersecting it. Hence there must be a curve $C$ on $G_{1}$ with $(rF-D) \cdot C >0$, but $rF-D \sim_{T} -D$ and $D$ is nef, a contradiction. Therefore $D-rF_p=0$ as claimed.
\end{proof}


The following gives a sufficient condition for a nef divisor to be EWM together with a very controlled version of resolution of indeterminacy of an EWM morphism (cf.~ \cite[Lemma 9.25]{bhatt2020}).

\begin{lemma}\label{two}
	Let $X \to T$ be a projective contraction of normal, integral, quasi-projective $R$-schemes.
	Let $L$ be a $\mathbb{Q}$-Cartier $\mathbb{Q}$-divisor on $X$, nef over $T$ such that $L|_{X_{K(T)}}$ and $L|_{X_{\mathbb{Q}}}$ are semi-ample.
	Assume $\dim (X) \leq 3$ and $L$ is not big. 
	Then $L$ is EWM and there is a commutative diagram of proper algebraic spaces over $T$:
	\[
	\begin{tikzcd}
	W \arrow[d, "g"] \arrow[r, "\phi"] & X \arrow[d, "f"] \\
	Y \arrow[r, "\pi"]                 & Z      ,        
	\end{tikzcd}
	\]
	such that 
	\begin{enumerate}
		\item $f$ is the EWM-contraction associated to $L$;
		\item $\phi$ and $\pi$ are proper birational contraction;
		\item  $g$ is equi-dimensional, $W$ is a $T$-projective scheme, and $Y$ is a $T$-projective regular scheme of dimension $\leq 2$;
		\item $g$ agrees with the map induced by $\phi^*L$ over the generic point of $Z$;
		\item  there exists a $\mathbb{Q}$-Cartier $\mathbb{Q}$-divisor $D$ on $Y$ such that $\phi^{*}L \sim_{\mathbb{Q}} g^{*}D$.
	\end{enumerate}  
\end{lemma}

\begin{proof}
	Note that if $\dim(T)=0$ there is nothing to prove, hence we can assume $\dim(T)\geq 1$. By \cite[Lemma 9.24]{bhatt2020} and its proof we can find a diagram of schemes over $T$:
	\[
	\begin{tikzcd}
	W \arrow[d, "g"] \arrow[r, "\phi"] & X  \\
	Y           &      ,
	\end{tikzcd}
	\]
	such that $\phi$ is birational and there exists a $\mathbb{Q}$-Cartier $\mathbb{Q}$-divisor $D$ on $Y$ such that (c)-(e) hold.
	By \autoref{as-ext} and \autoref{pp-EWM} it is sufficient to show that $D$ is EWM to conclude. If $\dim(Y) \leq 1,$ the result is trivial and if $\dim(Y)=2$, we apply \cite[Lemma 2.48]{bhatt2020}.
\end{proof}	

If $f$ is equi-dimensional, it is possible to prove a suitable semi-ampleness result.

\begin{proposition}\label{EDsemi-ampleness2}
	Let $X \to T$ be a projective contraction of normal quasi-projective schemes over $R$, where $\dim(X) \leq 3$.
	Let $L$ be an EWM $\mathbb{Q}$-Cartier $\mathbb{Q}$-divisor on $X$ such that its associated EWM-contraction $f \colon X \to Z$ is equi-dimensional.
	If $L|_{X_{K(T)}}$ and $L|_{X_{\mathbb{Q}}}$ are semi-ample, then $L$ is semi-ample.
\end{proposition}

\begin{proof}
	Without loss of generality we may assume $\dim(T)\geq 1$. If $L$ is big and $f$ is equi-dimensional, then $L$ is necessarily ample and we conclude.
	We can thus suppose $L$ is not big. We can then apply \autoref{two} and thus there exists a commutative diagram of proper algebraic spaces over $T$
	\[\begin{tikzcd}
	W \arrow[d, "g"] \arrow[r, "\phi"] & X \arrow[d, "f"] \\
	Y \arrow[r, "\pi"]             & Z  ,                
	\end{tikzcd}\]
	
	such that the following hold:
	
	\begin{enumerate}
		\item $W,X,Y$ are normal $T$-projective schemes and $\dim (Y) \leq 2$;
		\item the vertical maps $f$ and $g$ are equi-dimensional;
		\item the horizontal maps $\phi$ and $\pi$ are proper and birational;
		\item there exists a $\mathbb{Q}$-Cartier $\bQ$-divisor $D$ on $Y$ such that $\phi^{*}L \sim_{\mathbb{Q}} g^{*}D$.
	\end{enumerate}
	
	Since $Z$ is normal, there is an open immersion of a regular scheme $U \to Z$ containing every codimension 1 point of $Z$ by \autoref{l-cod1}.
	By (b), $X_{U} \to U$ satisfies the assumptions of \autoref{lemma:EDsemi-ampleness} and thus $L|_{X_{U}} \sim_{U,\mathbb{Q}} 0$. 
	
	If $\dim(Z)=1$, then we conclude immediately, so we can suppose $Z$ is a surface. Therefore $Z \setminus U$ consists of finitely many points.  
	Then we may choose $S$ to be a general hyperplane on $X$ such that $S$ meets each fibre over $Z \setminus U$ at only finitely many points. 
	%This may be done inductively by choosing hyperplanes $H_{i}$ such that they do not contain any component of any fibre of $S_{i}=\bigcap_{j< i} H_{j}$ over $Z\setminus U$. Then if $F$ is such a fibre, we have $\dim F\cap S_{i}=\dim F-i=r-i$, so $S=S_{r}$ meets $F$ at finitely many points.
	
	Note that $L|_{S}$ is clearly big and moreover if $C$ is any curve on $S$ with $L \cdot C =0$, then $C$ must be contracted by $X \to Z$ as $f$ is the EWM-contraction associated to $L$. In particular $C$ is contained in some fibre of $f$ and by construction $C$ is not contained in a fibre over $Z \setminus U$, as $S$ contains no such curves. Thus in fact $C \subseteq X_{U}$. Therefore $\mathbb{E}(L|_{S}) \subseteq X_{U}$ and so $S|_{\mathbb{E}(L|_{S})}$ is semi-ample since $L|_{X_{U}}$ is. As $L|_{S_{\mathbb{Q}}}$ is semi-ample by assumption, we conclude that $L|_{S}$ is semi-ample by \cite[Theorem 6.1]{witaszek2020keels}. 
	
	Let $S'$ be the strict transform of the surface $S$ on $W$, which must dominate $Y$. Let $\phi_{S'}, g_{S'}$ be the restrictions of $\phi, g$ to $S'$. Then $(\phi^{*}L)|_{S'}=\phi_{S'}^{*}(L|_{S})=g_{S'}^{*}D$ and since $L|_{S}$ is semi-ample and $Y$ is normal, we must have that $D$ is semi-ample by \autoref{pullback}. In turn this implies that $L$ is semi-ample as $\phi^{*}L=g^{*}D$.	
\end{proof}	

The following is a useful MMP technique to reduce to the case of equi-dimensional morphisms.

\begin{proposition}\label{three}
	Suppose that none of the residue fields of $R$ have characteristic $2,3$ and $5$. 
	Let $X \to T$ be a projective $R$-morphism of quasi-projective $R$-schemes with positive dimensional image and let $(X,B)$ be a $\mathbb{Q}$-factorial klt threefold pair.
	Suppose that
	\begin{enumerate}
		\item $K_X+B$ is a nef EWM $\mathbb{Q}$-divisor over $T$ with  $h \colon X \to Z$ be the associated EWM-contraction;
		\item $Z$ has dimension 2.
	\end{enumerate}
	
	Then there exists a $(K_X+B)$-trivial birational contraction $(X,B) \dashrightarrow (X', B')$ over $Z$ such that $X' \to Z$ is equi-dimensional. 
\end{proposition}

\begin{proof}
	Let $z \in Z$ be a closed point such that the fibre $h^{-1}(z)$ is not one-dimensional. By upper semi-continuity of fibre dimensions for proper morphisms (\cite[\href{https://stacks.math.columbia.edu/tag/0D4Q}{Tag 0D4Q}]{stacks-project}) $h^{-1}(z)$ must contain an irreducible divisor $F$.
	
	Take $t >0$ with $(X,B+tF)$ klt and run a $(K_X+B+tF)$-MMP over $T$. 
	We now show that this is an MMP over $Z$ as well.	
	Let $C$ be a curve generating an extremal $(K_X+B+tF)$-negative ray. As $(K_{X}+B)$ is nef over $T$, then $F\cdot C <0$. Therefore $C \subseteq F$ and since $F$ is contracted by $h$ to a point, so too is $C$. 
	By definition $X \to Z$ contracts only $(K_X+B)$-trivial curves. From this we can conclude that the $(K_X+B+tF)$-MMP over $T$ is also a $(K_X+B+tF)$-MMP over $Z$ by \autoref{as-ext}.  
	
	%After each step of this MMP $X \dashrightarrow X'$ we may need to replace $W$ with a higher model so that it admits a morphism to $X'$. We can then modify $Y$, using \autoref{two}, such that $W \to Y$ is equi-dimensional and hence the original assumptions of the proposition still hold on $X'$ with $Z$ unchanged. 
	
	Since this is an MMP of a pseudo-effective klt pair over $T$ it terminates by \autoref{MMP}. In fact we claim it terminates when the strict transform of $F$ is contracted.
	
	If $X\dashrightarrow X'$ does not contract $F$ then its transform on $X'$ remains the divisorial part of a fibre, so to establish this claim it is sufficient to show that such divisorial part is never nef. 
	By abundance on the generic fibre $(X'_{K(Z)},B'_{K(Z)})$ (\autoref{abundance-dim2}) we can apply \autoref{two} to find a commutative diagram 
	\[
	\begin{tikzcd}
	W \arrow[d, "g"] \arrow[r, "\phi"] & X' \arrow[d, "f'"]  \\
	Y\arrow[r, "\pi"]           & Z,              
	\end{tikzcd}
	\]
	where $g$ is equi-dimensional, $Y$ is a regular projective surface over $T$ and $\phi, \pi$ are proper birational.
	Let $F'$ be the strict transform of $F$ on $W$. Then $g(F')=\gamma$ must be an irreducible curve by equi-dimensionality and $\pi_*(\gamma)=z$. Choose a general curve $C$ in $F'$ such that $g(C)=\gamma$.
	Since is $D$ big, we write $D\sim_{\mathbb{R}} A+E$, for $A$ ample and $E$ effective by Kodaira's lemma.
	By Bertini theorems (\cite[Theorem 2.15]{bhatt2020}) we can choose a general $H \sim_{\mathbb{R}} A$ meeting $\gamma$ transversally. 
	Then $g^{*}H \cap C$ is a finite set of points and $g^{*}H$ is not contracted by $\phi$ as $H$ is general.
	%since $H$ is horizontal over $R$ and $f$ is an isomorphism over $\mathbb{Q}$ (\textcolor{red}{we need less than $f$ iso over $\mathbb{Q}$, no? we always have it essentially. no?}).
	We have $K_{X}+B \sim_{\mathbb{R}}\phi_{*}g^{*}(A+E) \sim_{\mathbb{R}}\phi_{*}g^{*}H+S$ where $S \geq 0$. As $C$ is general in $F'$ we have
	$$\phi_{*}g^{*}H \cdot \phi_{*}C >0 \textup{ and } (K_{X}+B)\cdot \phi_{*}C=g^{*}D \cdot C=D \cdot \gamma=0 \text{ as } \pi_*\gamma=z,$$ so we have $S \cdot C <0$. Since $C$ is general in $F'$ we must have that $F$ is contained in the support of $S$ and $F \cdot \phi_{*}C <0$.
	
	Since there are only finitely many closed points $z \in Z$ for which the fibres are not one dimensional, we can repeat the above process a finite number of times and we terminate with a crepant model $(X',B')$ which is equi-dimensional over $Z$.	
\end{proof}

We are now ready to prove the abundance theorem for klt threefolds over positive-dimensional basis, which are not of pure characteristic $0$.

\begin{theorem}\label{abundance}
	Suppose that none of the residue fields of $R$ have characteristic $2,3$ and $5$. 
	Let $\pi \colon X \to T$ be a projective morphism of quasi-projective $R$-schemes such that $\pi(X)$ is positive dimensional and it contains a closed point of characteristic $p>5$.
	Suppose $(X,B)$ is a klt threefold pair with $\mathbb{R}$-boundary. If $K_X+B$ is $\pi$-nef, then it is $\pi$-semi-ample.
\end{theorem}

\begin{proof}
	By Stein factorisation we can assume $\pi$ to be a contraction of normal schemes, so $\dim(T) \geq 1$.
	If $X$ is not $\mathbb{Q}$-factorial, then we may freely replace it with a $\mathbb{Q}$-factorialisation by \autoref{Q-factorial} and \autoref{l-inv-model}. Moreover by \autoref{QtoR} we can suppose that $\Delta$ is a $\mathbb{Q}$-boundary (we reduce to this case where we can apply the results of \cite{witaszek2020keels} which apply only to $\mathbb{Q}$-Cartier $\bQ$-divisors).
	As the dimension $X_{k(T)}$ is at most 2, we conclude by \cite[Lemma 9.22]{bhatt2020} and \autoref{abundance-dim2} that $\kappa(K_{X_{k(T)}}+B_{k(T)}) \geq 0$. We now divide the proof according to the value of $\kappa(K_{X_{k(T)}}+B_{k(T)})+\dim (T)$.
	
	\begin{case} 
		$\kappa(K_{X_{k(T)}}+B_{k(T)})+\dim (T)=3$.
	\end{case}
	In this case, $K_X+B$ is big and we can conclude by applying \autoref{t-bpf} to $L:=2(K_{X}+B)$.
	
	\begin{case}
		$\kappa(K_{X_{k(T)}}+B_{k(T)})+\dim (T)=2$.
	\end{case}
	By \autoref{abundance-dim2},  $K_{X_{k(T)}}+B_{k(T)}$ and $K_{X_\mathbb{Q}}+B_{\mathbb{Q}}$ are semi-ample $\mathbb{Q}$-divisors. As $K_X+B$ is not big, by \autoref{two} then $K_X+B$ is EWM and we denote by $f \colon X \to Z$ the associated EWM-contraction.
	By \autoref{three} and \autoref{inv} we may replace $X$ so that $X \to Z$ is equi-dimensional. We then apply \autoref{EDsemi-ampleness2} to deduce that $K_{X}+\Delta$ is $\pi$-semi-ample.
	
	\begin{case}
		$\kappa(K_{X_{k(T)}}+B_{k(T)})+\dim (T)=1$.
	\end{case} 
	The hypothesis $\dim (T) \geq 1$ implies  $\kappa(K_{X_{k(T)}}+B_{k(T)})=0$. Then $\pi \colon X \to T$ is flat, since $T$ is a Dedekind scheme and $X$ is integral by \cite[Proposition 9.7]{Ha77}. Since $K_{X_{{k(T)}}}+ B_{{k(T)}}$ is semi-ample by \autoref{abundance-dim2}, we conclude $K_X+B$ is semi-ample by \autoref{lemma:EDsemi-ampleness}. 
\end{proof}
	
	\begin{remark}
		While in this section we worked on threefolds over mixed characteristic rings whose residue fields have characteristic $p> 5$, this is just due to the current state of the art on the MMP. 
		The arguments in the section for $\kappa(K_{X_{k(T)}}+B_{k(T)})+\dim(T) \leq 2$ work as long as the MMP results are known to hold.
		In particular, abundance holds for mixed characteristic threefolds over a Dedekind domain with residue characteristics different from $2, 3$ by \cite{XX22}.
		%In fact the arguments in this section show that abundance in mixed characteristic holds in the case that $\kappa(K_{X}+B)+\dim R = 2$, assuming the MMP holds for pairs of dimension $\dim X $ and that appropriate resolution and abundance results hold in lower dimensions. 
	\end{remark}
	
\section{Applications to invariance of plurigenera}\label{s-inv-plurigenera}
	
	
	In this section, $R$ will always be an excellent DVR with $F$-finite residue field $k$ of characteristic $p>5$ and fraction field $K$. 
	
	The purpose of this section is to generalise the asymptotic invariance of plurigenera proven in \cite[Theorem 3.1]{EH} to families of \emph{non-log-smooth} surface pairs, as well as DVRs with non-perfect residue field. Similar results in characteristic zero are proven in \cite{HMX13, HMX18}.
	The first case we discuss is the asymptotic invariance for families of good minimal models.
	
	\begin{theorem}\label{thm:ADIOP_SA}
		Let $(X,B)$ be a three-dimensional $R$-pair with $\mathbb{Q}$-boundary.
		Let $\pi \colon X \to\Spec (R)$ be a  surjective projective contraction. Assume that $(X,B+X_k)$ is plt and $K_X+B$ is semiample over $R$.
		Suppose one of the following holds:
		\begin{enumerate}
			\item $\kappa(K_{X_k}+B_k)\neq 1$; or
			\item  $B_k$ big over $\Proj R(K_{X_k}+B_k)$.
		\end{enumerate} 
		Then there exists an $m_{0} \in \mathbb{N}$ such that 
		$$h^0(X_K,m(K_{X_K}+B_K))=h^0(X_k,m(K_{X_k}+B_k))$$
		for all $m\in m_0\bN$.
	\end{theorem}
	
	We start by showing the normality of the central fibre of the image of the $(K_X+B)$-semiample fibration.
	
	\begin{proposition}\label{p-gen-case}
		Let $(X,B)$ be a three-dimensional klt $R$-pair with $\mathbb{Q}$-boundary such that $\pi \colon X \to\Spec (R)$ is a surjective projective contraction.
		Suppose that $(X,B+X_{k})$ is plt. If $f \colon X \to Z$ is a birational morphism over $R$ such that $-(K_{X}+B)$ is $f$-nef, then $Z_k$ is normal and $f_{k,*}\ox[X_{k}]=\ox[Z_{k}]$.
	\end{proposition}
	
	\begin{proof}
		By \autoref{invAdj3} the central fibre $X_{k}$ is normal. 
		As $f$ is birational over $R$, so is $f_{k}$ and thus $-(K_{X_{k}}+B_{k})$ is $f_{k}$-big and $f_k$-nef. We conclude by \autoref{invAdj2}.
	\end{proof}
	
	The previous is useful for small $(K_{X}+B)$-trivial birational morphisms, and in particular to reduce the non $\mathbb{Q}$-factorial case to the $\mathbb{Q}$-factorial one.
	
	
	\begin{lemma}\label{l-reduce-Q-fac}
		Let $Y \to \Spec(R)$ be a projective contraction such that $(Y,Y_{k}+\Delta)$ is a plt threefold.
		Let $f \colon Y \to X$ be a $(K_{Y}+\Delta)$-trivial small birational contraction over $R$ with $B=\pi_{*}\Delta$. 
		Then
		$$h^{0}(X_{k},m(K_{X_k}+B_{k}))= h^{0}(Y_{k},m(K_{Y_{k}}+\Delta_{k}))$$ 
		for all $m$ sufficiently divisible. 
	\end{lemma}

	\begin{proof}
	%Write $K_Y+\Delta'=\pi^* (K_X+B)$, since $K_{Y}+\Delta$ is numerically $\pi$-trivial we have that $\Delta'-\Delta \equiv_{\pi} 0$. Similarly as $B=\pi_{*}\Delta$ we have that $\Delta'-\Delta$ is exceptional and hence $\Delta'-\Delta=0$ by the negativity lemma \cite[Lemma 2.14]{bhatt2020}. 
	
	As $f$ is small, the central fibre $Y_k$ is irreducible. 
	By \autoref{t-bpf},	$K_Y+Y_k+\Delta \sim_{\mathbb{Q}} f^*(K_X+X_k+B)$.
	Then by \autoref{p-gen-case}, $Y_k$ and $X_k$ are both normal.
	As $f$ is the semi-ample fibration associated to $K_Y+\Delta$ over $X$ and it is birational, we conclude by \autoref{l-stein-invariance}.
\	end{proof}

	We now discuss the delicate case of invariance for plurigenera where the Kodaira dimension is one and the boundary is big.
	
	
	\begin{proposition}\label{p-1-case}
		
		Let $(X,B)/R$ be a $\mathbb{Q}$-factorial klt pair of dimension $3$ with a projective contraction $\pi \colon X \to \Spec(R)$ such that $(X,B+X_{k})$ is plt. Suppose that
		\begin{enumerate}
			\item $K_X+B$ is semiample and let $f\colon X \to Z$ its Iitaka fibration over $R$;
			\item $\kappa(K_X+B/R)=1$;
			\item $B_{k}$ is big over $Z_{k}$.
		\end{enumerate}
		Then there exists an $m_{0} \in \mathbb{N}$  such that 
		$$h^0(X_K,m(K_{X_K}+B_K))=h^0(X_k,m(K_{X_k}+B_k))$$
		for all $m\in m_0\bN$.	
	\end{proposition}
	
	\begin{proof}
%		Let $(Y, \Delta) \to (X, B)$ be a small $\mathbb{Q}$-factorialisation. 
%		Consider the morphism $X_{k} \to Z_{k}$. If $F$ is a general fibre then $F \cdot B_{k} > 0$ by assumption. Let $G=\pi^{*}_{k}F$ be a general fibre of $Y_{k} \to Z_{k}$. Then as $\pi_{k,*}\Delta_{k}=B_{k}$ we have $\Delta_{k} \cdot G=B_{k}\cdot F > 0$, so $\Delta_{k}$ is also big over $Z_{k}$. Together with \autoref{l-reduce-Q-fac} we can replace $(X,B)$ by $(Y,\Delta)$ and suppose $\mathbb{Q}$-factoriality of the pair $(X,B)$.
		
		As $K_X$ is not pseudoeffective over $X$, we now run a $K_{X}$-MMP over $Z$ with scaling of $A$ which terminates by \autoref{MMP} with a Mori fibre space $X \to Z'/Z$ since $B_k$ is big over $Z_k$. 
		Since each step is $(K_{X}+B)$-trivial and does not contract $X_{k}$, $(X,B+X_{k})$ remains plt and so $X_{k}$ stays irreducible and normal by \autoref{invAdj3}.
		
		Consider a step of this MMP $\phi \colon X \dashrightarrow X'$ and let $B':=\phi_*B$.  We have
		
		\[\begin{tikzcd}
			X \arrow[swap, rd, "g"] \arrow[rr, "\phi", dashed] &                 & X' \arrow[ld, "h"] \\
			& Y \arrow[d] &                        \\
			& Z ,         &                       
		\end{tikzcd}\]

where $h$ may either be an isomorphism or a small birational contraction. As $g$ is $(K_X+B)$-trivial, by \autoref{p-gen-case} we have that $Y_k$ is irreducible and normal as well. Let now $(Y,\Xi)$ be the induced pair on $Y$: we then have
		$$h^{0}(X_{k},m(K_{X_k}+B_{k}))=h^{0}(Y_{k},m(K_{Y_{k}}+\Xi_k))=h^{0}(X'_{k},m(K_{X'_k}+B'_{k}))$$ 
		
		where the first equality also follows from \autoref{p-gen-case} and \autoref{l-stein-invariance} and the latter is \autoref{l-reduce-Q-fac}. Also the sections of $m(K_{X}+B)$ are preserved by this MMP for large divisible $m > 0$.
		
		Hence we can now suppose $X$ admits a Mori fibre space $X \to Z'/Z$, with $B_{k}$ big over $Z_{k}$.
		
		We claim that $Z'=Z$.
		Indeed, suppose for contradiction that there exists a divisor $D$ on $Z'$ which is contracted by $Z' \to Z$. Since $\dim Z=2$, $D$ must be contained in $Z'_k$. But then $f^{-1}D$ is a surface inside $X_{k}$, which is irreducible by assumption. It cannot be that $X_{k}$ is contracted to a point over $Z$, thus no such $D$ exists and we have $Z=Z'$.
		
		In particular $-K_{X'}$ is ample over $Z$ and hence by \autoref{invAdj2} we have that $f_{k,*} \ox[X_{k}]=\ox[Z_{k}]$ and the result follows from \autoref{l-stein-invariance}.
	\end{proof}
	
	
	We can now prove the asymptotic invariance of plurigenera in a family of minimal models.
	
	\begin{proof}[Proof of \autoref{thm:ADIOP_SA}]
		By \autoref{l-reduce-Q-fac} we can suppose $X$ is $\mathbb{Q}$-factorial.
		We have $\kappa(K_{X_k}+B_k)=\kappa(K_{X_K}+B_K)=\kappa$, since the Iitaka dimension is deformation invariant for semiample line bundles by \autoref{lemma_DIOK}. Let $f \colon X\to Z/\Spec (R)$ be the relative Iitaka fibration, so that $K_X+B\sim_{\bQ}f^\ast A$ for some ample $\bQ$-divisor. 
		We now divide in various cases.
		
		If $\kappa=0$, then $K_X+B\sim_{\bQ}0$ and hence we conclude by \autoref{lemma_DIOK}.
		If $\kappa=1$, then this is \autoref{p-1-case}. 
		Finally in the case $\kappa=2$ we conclude by \autoref{p-gen-case} and \autoref{l-stein-invariance}. 	
	\end{proof}
	
	
	Putting these results together with \autoref{lemma:MMP_in_fam2} and the abundance theorem \autoref{abundance} we deduce an asymptotic invariance result for plurigenera on suitable families. 
	

	Imposing the conditions of \autoref{lemma:MMP_in_fam2}, we are able to prove the invariance of plurigenera for families of klt surfaces from \autoref{thm:ADIOP_SA}.
	
	\begin{theorem}\label{thm:ADIOP_final2}
		Suppose that $(X,B)$ is a projective three dimensional klt $R$-pair with $\mathbb{Q}$-boundary which dominates $R$.
		Suppose that all of the following are satisfied:
		
		\begin{enumerate}
			\item[(1)] $(X, X_{k}+B)$ is plt with $X_k$ integral and normal;
			\item[(2)]  ${\mathbf{B}_{-}(X, K_{X}+B)}$ contains a non-canonical centre $V$ of $(X,B+X_{k})$ only if $\dim V_{k}=\dim V -1$.
		\end{enumerate}
		
		Suppose further that at least one of the following holds:
		\begin{enumerate}
			\item $\kappa(K_{X_{k}}+B_{k}) \neq 1$; or
			\item $B_{k}$ is big over $\textup{Proj}(K_{X_{k}}+B_{k})$
		\end{enumerate}	
		Then there is $m_{0} \in \mathbb{N}$ such that 
		$$h^{0}(X_{K},m(K_{X_{K}}+B_{K}))=h^{0}(X_{k},m(K_{X_{k}}+B_{k}))$$
		for all $m \in m_{0}\mathbb{N}$.
		
	\end{theorem}
	
	\begin{proof}
		By \autoref{l-reduce-Q-fac} we can suppose $X$ is $\mathbb{Q}$-factorial.
		We may run a $(K_X+B)$-MMP over $R$ which terminates by \autoref{MMP}. 
		We call $(Y,\Gamma)$ the end-product of this MMP. Since $(X,B)$ satisfies conditions (1)-(2) of \autoref{lemma:MMP_in_fam2} we deduce $h^{0}(X_{k},m(K_{X_{k}} + B_{k}))=h^0(Y_k, m(K_{Y_k}+\Gamma_k))$ for all sufficiently divisible $m$. 
		In the case where $\kappa(K_{X_{k}}+B_{k})=1$, the condition that $B_{k}$ is big over $\textup{Proj}(K_{X_{k}}+B_{k})$ is also preserved by the MMP.
		
		If $K_{X}+B$ is pseudo-effective then $K_Y+\Gamma$ is nef over $R$. Therefore, by \autoref{abundance}, $K_{X}+B$ is semiample and the result then follows from \autoref{thm:ADIOP_SA}. 
		If $K_X+B$ is not pseudoeffective over $R$, then there is a Mori fibre space structure $(Y,\Gamma) \to Z$. This ensures that neither $K_{Y}+\Gamma$ nor $K_{Y_{k}}+\Gamma_{k}$ are pseudo-effective and thus the result holds trivially. 
	\end{proof}
	
	
	\begin{remark}	
		The $p>5$ assumption is essential to the adjunction type results used in \autoref{p-gen-case}. Even if the MMP was known in lower characteristic, our arguments in this section would not extend immediately.
	\end{remark}

%	
%	\bibliographystyle{amsalpha}
%	\bibliography{refs}
%\end{document}

